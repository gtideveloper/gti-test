!function(e,a,t,r,n){"use strict";t?r?t(a).ready(function(){function n(){t('#calendar [data-toggle="popover"]').popover({html:!0,placement:"auto",viewport:".o-calendar"}),t('#calendar [data-toggle="popover"]').on("hide.bs.popover",function(){t(".o-calendar-day").removeClass("is-active")})}n();var o=t("#calendar");function i(e,a){a.type=-1===["milestone","task","bug"].indexOf(a.type)?"all":a.type,a.assigned_to=parseInt(a.assigned_to),t(".c-calendar__body table tbody .o-calendar-day__item",e).each(function(){var e=t(this);if("all"===a.type||e.attr("data-type")===a.type){var r=e.data("assigned_to").toString().split(",")||[];a.assigned_to<0||r.indexOf(a.assigned_to+"")>=0?e.show():e.hide()}else e.hide()})}function d(){var e=t('select[data-filter="user"]',o),a=e.val();return"none"===a?0:"me"===a?e.data("current_user"):"all"===a?-1:a}function s(){return t('select[data-filter="type"]',o).val()}function l(e,a){var o=t("#calendar"),i=t("table",o);t.ajax({type:"GET",url:r.ajaxurl,data:{action:"upstream.calendar-view:project.calendar.change_date",nonce:r.nonce,project_id:r.project_id,direction:void 0!==e?e:"today",amount:void 0!==a?a:"none",start_date:i.data("date"),first_day:i.data("first_day"),weeks:i.data("weeks"),is_archive:r.isArchive},beforeSend:function(){o.addClass("is-loading"),t('select[data-filter="month"]',o).val("0")},success:function(e){if(e.success){if(e.data){t(".c-calendar__body table",o).replaceWith(e.data),n(),c()}}else e.error_message&&alert(e.error_message);o.removeClass("is-loading")},error:function(e,a,t){console.error(t),o.removeClass("is-loading")}})}function c(){var e=t("#calendar .o-calendar"),a=Math.floor(e.width()/7)-12;t(".o-calendar-day__items > .o-calendar-day__item:not(.s-pill)").each(function(){var e=t(this);e.css("width",a),e.hasClass("s-truncate")||e.addClass("s-truncate")})}t('select[data-filter="month"]',o).on("change",function(e){e.preventDefault(),e.stopPropagation();var a=t("#calendar");t.ajax({type:"GET",url:r.ajaxurl,data:{action:"upstream.calendar-view:project.get_calendar_data",nonce:r.nonce,project_id:r.project_id,weeks:t('select[data-filter="weeks"]',a).val(),month:t(this).val(),is_archive:r.isArchive},beforeSend:function(){a.addClass("is-loading")},success:function(e){if(e.success)if(e.data){t(".c-calendar__body table",a).replaceWith(e.data),n(),c(),i(a,{type:s(),assigned_to:d()})}else console.error("no data returned");else console.error(e.error_message);a.removeClass("is-loading")},error:function(e,t,r){console.error(r),a.removeClass("is-loading")}})}),t('select[data-filter="weeks"]',o).on("change",function(e){e.preventDefault(),e.stopPropagation();var a=t("#calendar");t.ajax({type:"GET",url:r.ajaxurl,data:{action:"upstream.calendar-view:project.get_calendar_data",nonce:r.nonce,project_id:r.project_id,weeks:t(this).val(),is_arquive:r.isArchive,date:t(".o-calendar",a).attr("data-date")},beforeSend:function(){a.addClass("is-loading")},success:function(e){if(e.success)if(e.data){t(".c-calendar__body table",a).replaceWith(e.data),n(),c(),i(a,{type:s(),assigned_to:d()})}else console.error("no data returned");else console.error(e.error_message);a.removeClass("is-loading")},error:function(e,t,r){console.error(r),a.removeClass("is-loading")}})}),t("select[data-filter]",o).on("change",function(){i(o,{assigned_to:d(),type:s()})}),t('[data-target="calendar"][data-direction]').on("click",function(e){var a=t(this);l(a.data("direction"),a.data("amount")||"none")}),t("#calendar").on("click",".o-calendar-day__item:not(.s-filler)",function(){var e=t(this).parents(".o-calendar-day");t(".o-calendar-day__items > .o-calendar-day__item:not(.s-filler)",e).length>0&&e.addClass("is-active")}),t('[data-action="reset_filters"]').on("click",function(e){e.preventDefault(),{assigned_to:-1,type:"all"};var a=t('select[data-filter="user"]',o);t("option",a).attr("selected",!1),t('option[value="all"]',a).attr("selected","selected");var r=t('select[data-filter="type"]',o);1===r.length&&(t("option",r).attr("selected",!1),t('option[value="all"]',r).attr("selected","selected"));var n=t('select[data-filter="weeks"]',o),i=n.attr("data-default");t('option[value="'+i+'"]',n).attr("selected","selected"),t("table",o).attr("data-weeks",i),t('select[data-filter="month"]',o).val("0"),l()}),t("#calendar").on("click",'[data-action="calendar.edit"][data-id]',function(e){if(e.preventDefault(),1===e.which){var a=t(this),r=a.attr("data-id")||"";if(r){var n=t('.o-data-table > tbody > tr[data-id="'+r+'"] > td .o-edit-link[data-toggle="up-modal"]');if(n.length>0){var o=t(n.parents("tr[data-id]").get(0));t(".fa-pencil",a).removeClass("fa-pencil").addClass("fa-spinner fa-spin"),a.attr("disabled","disabled").addClass("disabled"),n.trigger("click");var i=0,d=setInterval(function(){o.hasClass("is-being-opened")&&(p.popover("hide"),clearInterval(d),t(".fa",a).removeClass("fa-spinner fa-spin").addClass("fa-pencil"),a.attr("disabled",null).removeClass("disabled")),50===i&&clearInterval(d),i++},200)}else(n=t('table.datatable[data-type] > tbody > tr > td > a[data-toggle="up-modal"][data-id="'+r+'"]')).length>0&&p.popover("hide")}}}),c(),t(e).on("resize",c);var p=null;t("#calendar").on("click",'.o-calendar-day__item[data-toggle="popover"]',function(e){e.preventDefault();var a=t(this);p&&p.popover("hide"),p=a,a.popover("toggle"),e.stopPropagation()}),t(a).on("click",function(e){0===t(e.srcElement||e.originalTarget).parents('.popover[id^="popover"]').length&&t(".o-calendar-day__item").popover("hide")})}):console.error("Invalid data."):console.error("UpStream > Calendar View requires jQuery to run.")}(window,window.document,jQuery,$data);
